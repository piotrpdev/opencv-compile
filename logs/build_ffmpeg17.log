#0 building with "default" instance using docker driver

#1 [internal] load build definition from ubuntu-22.04-opencv-full-build.Dockerfile
#1 transferring dockerfile: 6.87kB done
#1 DONE 0.0s

#2 [internal] load metadata for docker.io/library/ubuntu:22.04
#2 DONE 0.0s

#3 [internal] load metadata for docker.io/library/node:22.12
#3 ...

#4 [auth] library/node:pull token for registry-1.docker.io
#4 DONE 0.0s

#3 [internal] load metadata for docker.io/library/node:22.12
#3 DONE 1.8s

#5 [internal] load .dockerignore
#5 transferring context: 2B done
#5 DONE 0.0s

#6 [frontend 1/3] FROM docker.io/library/node:22.12@sha256:0e910f435308c36ea60b4cfd7b80208044d77a074d16b768a81901ce938a62dc
#6 DONE 0.0s

#7 [opencv_download 1/4] FROM docker.io/library/ubuntu:22.04
#7 DONE 0.0s

#8 [opencv_download 2/4] RUN set -xeu &&     apt-get update &&     DEBIAN_FRONTEND=noninteractive apt-get dist-upgrade -y &&     apt-get autoremove -y --purge &&     apt-get -y autoclean
#8 CACHED

#9 [opencv_download 3/4] RUN set -xeu && 	DEBIAN_FRONTEND=noninteractive apt-get install -y curl
#9 0.376 + DEBIAN_FRONTEND=noninteractive apt-get install -y curl
#9 0.405 Reading package lists...
#9 1.116 Building dependency tree...
#9 1.309 Reading state information...
#9 1.525 The following additional packages will be installed:
#9 1.526   ca-certificates libbrotli1 libcurl4 libldap-2.5-0 libldap-common
#9 1.526   libnghttp2-14 libpsl5 librtmp1 libsasl2-2 libsasl2-modules
#9 1.527   libsasl2-modules-db libssh-4 openssl publicsuffix
#9 1.528 Suggested packages:
#9 1.528   libsasl2-modules-gssapi-mit | libsasl2-modules-gssapi-heimdal
#9 1.528   libsasl2-modules-ldap libsasl2-modules-otp libsasl2-modules-sql
#9 1.569 The following NEW packages will be installed:
#9 1.570   ca-certificates curl libbrotli1 libcurl4 libldap-2.5-0 libldap-common
#9 1.570   libnghttp2-14 libpsl5 librtmp1 libsasl2-2 libsasl2-modules
#9 1.571   libsasl2-modules-db libssh-4 openssl publicsuffix
#9 1.794 0 upgraded, 15 newly installed, 0 to remove and 0 not upgraded.
#9 1.794 Need to get 2996 kB of archives.
#9 1.794 After this operation, 7136 kB of additional disk space will be used.
#9 1.794 Get:1 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 openssl amd64 3.0.2-0ubuntu1.18 [1184 kB]
#9 2.481 Get:2 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 ca-certificates all 20240203~22.04.1 [162 kB]
#9 2.489 Get:3 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libnghttp2-14 amd64 1.43.0-1ubuntu0.2 [76.9 kB]
#9 2.494 Get:4 http://archive.ubuntu.com/ubuntu jammy/main amd64 libpsl5 amd64 0.21.0-1.2build2 [58.4 kB]
#9 2.497 Get:5 http://archive.ubuntu.com/ubuntu jammy/main amd64 publicsuffix all 20211207.1025-1 [129 kB]
#9 2.505 Get:6 http://archive.ubuntu.com/ubuntu jammy/main amd64 libbrotli1 amd64 1.0.9-2build6 [315 kB]
#9 2.522 Get:7 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libsasl2-modules-db amd64 2.1.27+dfsg2-3ubuntu1.2 [20.5 kB]
#9 2.523 Get:8 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libsasl2-2 amd64 2.1.27+dfsg2-3ubuntu1.2 [53.8 kB]
#9 2.526 Get:9 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libldap-2.5-0 amd64 2.5.18+dfsg-0ubuntu0.22.04.2 [183 kB]
#9 2.536 Get:10 http://archive.ubuntu.com/ubuntu jammy/main amd64 librtmp1 amd64 2.4+20151223.gitfa8646d.1-2build4 [58.2 kB]
#9 2.563 Get:11 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libssh-4 amd64 0.9.6-2ubuntu0.22.04.3 [186 kB]
#9 2.576 Get:12 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libcurl4 amd64 7.81.0-1ubuntu1.20 [289 kB]
#9 2.593 Get:13 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 curl amd64 7.81.0-1ubuntu1.20 [194 kB]
#9 2.604 Get:14 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libldap-common all 2.5.18+dfsg-0ubuntu0.22.04.2 [15.9 kB]
#9 2.604 Get:15 http://archive.ubuntu.com/ubuntu jammy-updates/main amd64 libsasl2-modules amd64 2.1.27+dfsg2-3ubuntu1.2 [68.8 kB]
#9 2.699 debconf: delaying package configuration, since apt-utils is not installed
#9 2.728 Fetched 2996 kB in 1s (2914 kB/s)
#9 2.766 Selecting previously unselected package openssl.
#9 2.766 (Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 4393 files and directories currently installed.)
#9 2.769 Preparing to unpack .../00-openssl_3.0.2-0ubuntu1.18_amd64.deb ...
#9 2.779 Unpacking openssl (3.0.2-0ubuntu1.18) ...
#9 2.871 Selecting previously unselected package ca-certificates.
#9 2.872 Preparing to unpack .../01-ca-certificates_20240203~22.04.1_all.deb ...
#9 2.881 Unpacking ca-certificates (20240203~22.04.1) ...
#9 2.987 Selecting previously unselected package libnghttp2-14:amd64.
#9 2.988 Preparing to unpack .../02-libnghttp2-14_1.43.0-1ubuntu0.2_amd64.deb ...
#9 3.006 Unpacking libnghttp2-14:amd64 (1.43.0-1ubuntu0.2) ...
#9 3.075 Selecting previously unselected package libpsl5:amd64.
#9 3.076 Preparing to unpack .../03-libpsl5_0.21.0-1.2build2_amd64.deb ...
#9 3.086 Unpacking libpsl5:amd64 (0.21.0-1.2build2) ...
#9 3.135 Selecting previously unselected package publicsuffix.
#9 3.136 Preparing to unpack .../04-publicsuffix_20211207.1025-1_all.deb ...
#9 3.145 Unpacking publicsuffix (20211207.1025-1) ...
#9 3.213 Selecting previously unselected package libbrotli1:amd64.
#9 3.214 Preparing to unpack .../05-libbrotli1_1.0.9-2build6_amd64.deb ...
#9 3.224 Unpacking libbrotli1:amd64 (1.0.9-2build6) ...
#9 3.275 Selecting previously unselected package libsasl2-modules-db:amd64.
#9 3.276 Preparing to unpack .../06-libsasl2-modules-db_2.1.27+dfsg2-3ubuntu1.2_amd64.deb ...
#9 3.286 Unpacking libsasl2-modules-db:amd64 (2.1.27+dfsg2-3ubuntu1.2) ...
#9 3.351 Selecting previously unselected package libsasl2-2:amd64.
#9 3.352 Preparing to unpack .../07-libsasl2-2_2.1.27+dfsg2-3ubuntu1.2_amd64.deb ...
#9 3.362 Unpacking libsasl2-2:amd64 (2.1.27+dfsg2-3ubuntu1.2) ...
#9 3.429 Selecting previously unselected package libldap-2.5-0:amd64.
#9 3.430 Preparing to unpack .../08-libldap-2.5-0_2.5.18+dfsg-0ubuntu0.22.04.2_amd64.deb ...
#9 3.440 Unpacking libldap-2.5-0:amd64 (2.5.18+dfsg-0ubuntu0.22.04.2) ...
#9 3.508 Selecting previously unselected package librtmp1:amd64.
#9 3.509 Preparing to unpack .../09-librtmp1_2.4+20151223.gitfa8646d.1-2build4_amd64.deb ...
#9 3.518 Unpacking librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2build4) ...
#9 3.585 Selecting previously unselected package libssh-4:amd64.
#9 3.586 Preparing to unpack .../10-libssh-4_0.9.6-2ubuntu0.22.04.3_amd64.deb ...
#9 3.596 Unpacking libssh-4:amd64 (0.9.6-2ubuntu0.22.04.3) ...
#9 3.665 Selecting previously unselected package libcurl4:amd64.
#9 3.665 Preparing to unpack .../11-libcurl4_7.81.0-1ubuntu1.20_amd64.deb ...
#9 3.674 Unpacking libcurl4:amd64 (7.81.0-1ubuntu1.20) ...
#9 3.730 Selecting previously unselected package curl.
#9 3.731 Preparing to unpack .../12-curl_7.81.0-1ubuntu1.20_amd64.deb ...
#9 3.741 Unpacking curl (7.81.0-1ubuntu1.20) ...
#9 3.799 Selecting previously unselected package libldap-common.
#9 3.800 Preparing to unpack .../13-libldap-common_2.5.18+dfsg-0ubuntu0.22.04.2_all.deb ...
#9 3.809 Unpacking libldap-common (2.5.18+dfsg-0ubuntu0.22.04.2) ...
#9 3.876 Selecting previously unselected package libsasl2-modules:amd64.
#9 3.877 Preparing to unpack .../14-libsasl2-modules_2.1.27+dfsg2-3ubuntu1.2_amd64.deb ...
#9 3.886 Unpacking libsasl2-modules:amd64 (2.1.27+dfsg2-3ubuntu1.2) ...
#9 3.951 Setting up libpsl5:amd64 (0.21.0-1.2build2) ...
#9 3.979 Setting up libbrotli1:amd64 (1.0.9-2build6) ...
#9 4.007 Setting up libsasl2-modules:amd64 (2.1.27+dfsg2-3ubuntu1.2) ...
#9 4.045 Setting up libnghttp2-14:amd64 (1.43.0-1ubuntu0.2) ...
#9 4.073 Setting up libldap-common (2.5.18+dfsg-0ubuntu0.22.04.2) ...
#9 4.109 Setting up libsasl2-modules-db:amd64 (2.1.27+dfsg2-3ubuntu1.2) ...
#9 4.136 Setting up librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2build4) ...
#9 4.164 Setting up libsasl2-2:amd64 (2.1.27+dfsg2-3ubuntu1.2) ...
#9 4.190 Setting up libssh-4:amd64 (0.9.6-2ubuntu0.22.04.3) ...
#9 4.218 Setting up openssl (3.0.2-0ubuntu1.18) ...
#9 4.256 Setting up publicsuffix (20211207.1025-1) ...
#9 4.282 Setting up libldap-2.5-0:amd64 (2.5.18+dfsg-0ubuntu0.22.04.2) ...
#9 4.310 Setting up ca-certificates (20240203~22.04.1) ...
#9 4.649 Updating certificates in /etc/ssl/certs...
#9 5.067 146 added, 0 removed; done.
#9 5.113 Setting up libcurl4:amd64 (7.81.0-1ubuntu1.20) ...
#9 5.140 Setting up curl (7.81.0-1ubuntu1.20) ...
#9 5.167 Processing triggers for libc-bin (2.35-0ubuntu3.8) ...
#9 5.202 Processing triggers for ca-certificates (20240203~22.04.1) ...
#9 5.215 Updating certificates in /etc/ssl/certs...
#9 5.522 0 added, 0 removed; done.
#9 5.522 Running hooks in /etc/ca-certificates/update.d...
#9 5.523 done.
#9 DONE 5.6s

#10 [opencv_download 4/4] RUN set -xeu &&     mkdir -p /root/dist &&     curl -sSfL "https://github.com/opencv/opencv/archive/refs/tags/4.8.0.tar.gz" | tar xz -C /root/dist &&     curl -sSfL "https://github.com/opencv/opencv_contrib/archive/refs/tags/4.8.0.tar.gz" | tar xz -C /root/dist &&     sed -ri 's/Ptr<FarnebackOpticalFlow> cv::cuda::FarnebackOpticalFlow::create/Ptr<cv::cuda::FarnebackOpticalFlow> cv::cuda::FarnebackOpticalFlow::create/' "/root/dist/opencv_contrib-4.8.0/modules/cudaoptflow/src/farneback.cpp" # patch for version 4.8.0
#10 0.454 + mkdir -p /root/dist
#10 0.455 + curl -sSfL https://github.com/opencv/opencv/archive/refs/tags/4.8.0.tar.gz
#10 0.456 + tar xz -C /root/dist
#10 7.292 + curl -sSfL https://github.com/opencv/opencv_contrib/archive/refs/tags/4.8.0.tar.gz
#10 7.292 + tar xz -C /root/dist
#10 12.37 + sed -ri s/Ptr<FarnebackOpticalFlow> cv::cuda::FarnebackOpticalFlow::create/Ptr<cv::cuda::FarnebackOpticalFlow> cv::cuda::FarnebackOpticalFlow::create/ /root/dist/opencv_contrib-4.8.0/modules/cudaoptflow/src/farneback.cpp
#10 DONE 12.6s

#11 [test  7/11] RUN set -xeu && 	ls /opt/opencv/lib && 	ls /opt/opencv/lib/opencv4/3rdparty && 	ls /usr/lib/x86_64-linux-gnu && 	ls /opt/opencv/include && 	ls /opt/opencv/include/opencv4 && 	ls /usr/include/x86_64-linux-gnu
#11 CACHED

#12 [test  9/11] RUN set -xeu &&     DEBIAN_FRONTEND=noninteractive apt-get install -y libasound2 libatk-bridge2.0-0 libatk1.0-0 	libatspi2.0-0 libcairo2 libcups2 libdbus-1-3 libdrm2 libgbm1 libglib2.0-0 libnspr4 libnss3 	libpango-1.0-0 libwayland-client0 libx11-6 libxcb1 libxcomposite1 libxdamage1 libxext6 	libxfixes3 libxkbcommon0 libxrandr2 	pkg-config libssl-dev
#12 CACHED

#13 [test  6/11] COPY --from=frontend /root/oko /root/oko
#13 CACHED

#14 [backend 3/5] RUN set -xeu &&     DEBIAN_FRONTEND=noninteractive apt-get install -y clang libclang-dev cmake     libatlas-base-dev libceres-dev libeigen3-dev libprotobuf-dev protobuf-compiler libva-dev     libavcodec-dev libavformat-dev libavutil-dev libswscale-dev
#14 CACHED

#15 [backend 5/5] RUN set -xeu &&     mkdir -p /root/build &&     cmake -B /root/build -S "/root/dist/opencv-4.8.0" -D OPENCV_EXTRA_MODULES_PATH="/root/dist/opencv_contrib-4.8.0/modules" -D CMAKE_INSTALL_PREFIX=/opt/opencv     	-D BUILD_CUDA_STUBS=OFF     	-D BUILD_DOCS=OFF     	-D BUILD_EXAMPLES=OFF     	-D BUILD_IPP_IW=ON     	-D BUILD_ITT=OFF     	-D BUILD_JASPER=ON     	-D BUILD_JAVA=OFF     	-D BUILD_JPEG=ON     	-D BUILD_OPENEXR=OFF     	-D BUILD_PERF_TESTS=OFF     	-D BUILD_PNG=ON     	-D BUILD_PROTOBUF=ON     	-D BUILD_SHARED_LIBS=OFF     	-D BUILD_TBB=OFF     	-D BUILD_TESTS=OFF     	-D BUILD_TIFF=OFF     	-D BUILD_WEBP=OFF     	-D BUILD_WITH_DYNAMIC_IPP=OFF     	-D BUILD_ZLIB=ON 		-D BUILD_opencv_freetype=OFF     	-D BUILD_opencv_apps=OFF     	-D BUILD_opencv_python2=OFF     	-D BUILD_opencv_python3=OFF     	-D CMAKE_BUILD_TYPE=Release     	-D ENABLE_CONFIG_VERIFICATION=OFF     	-D CV_ENABLE_INTRINSICS=ON     	-D ENABLE_PIC=ON     	-D INSTALL_CREATE_DISTRIB=OFF     	-D INSTALL_PYTHON_EXAMPLES=OFF     	-D INSTALL_C_EXAMPLES=OFF     	-D INSTALL_TESTS=OFF     	-D OPENCV_ENABLE_NONFREE=ON     	-D OPENCV_FORCE_3RDPARTY_BUILD=ON     	-D OPENCV_GENERATE_PKGCONFIG=OFF     	-D PROTOBUF_UPDATE_FILES=OFF     	-D WITH_1394=OFF     	-D WITH_ADE=ON     	-D WITH_ARAVIS=OFF     	-D WITH_CLP=OFF     	-D WITH_CUBLAS=OFF     	-D WITH_CUDA=OFF     	-D WITH_CUFFT=OFF     	-D WITH_EIGEN=ON     	-D WITH_FFMPEG=ON 		-D WITH_FREETYPE=OFF     	-D WITH_GDAL=OFF     	-D WITH_GDCM=OFF     	-D WITH_GIGEAPI=OFF     	-D WITH_GPHOTO2=OFF     	-D WITH_GSTREAMER=OFF     	-D WITH_GSTREAMER_0_10=OFF     	-D WITH_GTK=OFF     	-D WITH_GTK_2_X=OFF     	-D WITH_HALIDE=OFF     	-D WITH_IMGCODEC_HDcR=OFF     	-D WITH_IMGCODEC_PXM=OFF     	-D WITH_IMGCODEC_SUNRASTER=OFF     	-D WITH_INF_ENGINE=OFF     	-D WITH_IPP=ON     	-D WITH_ITT=OFF     	-D WITH_JASPER=ON     	-D WITH_JPEG=ON     	-D WITH_LAPACK=OFF     	-D WITH_LIBV4L=OFF     	-D WITH_MATLAB=OFF     	-D WITH_MFX=OFF     	-D WITH_NVCUVID=OFF     	-D WITH_OPENCL=ON     	-D WITH_OPENCLAMDBLAS=ON     	-D WITH_OPENCLAMDFFT=ON     	-D WITH_OPENCL_SVM=ON     	-D WITH_OPENEXR=OFF     	-D WITH_OPENGL=OFF     	-D WITH_OPENMP=OFF     	-D WITH_OPENNI2=OFF     	-D WITH_OPENNI=OFF     	-D WITH_OPENVX=OFF     	-D WITH_PNG=ON     	-D WITH_PROTOBUF=ON     	-D WITH_PTHREADS_PF=ON     	-D WITH_PVAPI=OFF     	-D WITH_QT=OFF     	-D WITH_QUIRC=OFF     	-D WITH_TBB=OFF     	-D WITH_TIFF=OFF     	-D WITH_UNICAP=OFF     	-D WITH_V4L=ON     	-D WITH_VA=ON     	-D WITH_VA_INTEL=ON     	-D WITH_VTK=OFF     	-D WITH_WEBP=OFF     	-D WITH_XIMEA=OFF     	-D WITH_XINE=OFF &&     make -C /root/build -j`nproc` install
#15 CACHED

#16 [test 10/11] RUN set -xu && 	cd /root/oko/backend && 	cargo test; exit 0
#16 CACHED

#17 [test  4/11] RUN set -xeu &&     curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --profile=minimal
#17 CACHED

#18 [backend 4/5] COPY --from=opencv_download /root/dist /root/dist
#18 CACHED

#19 [test  8/11] RUN set -xeu && 	cd /root/oko/backend && 	cargo build
#19 CACHED

#20 [frontend 3/3] RUN set -xeu && 	npm --prefix=/root/oko/frontend ci && 	npm --prefix=/root/oko/frontend run build && 	mkdir -p /root/oko/backend/static && 	cp -r /root/oko/frontend/dist/* /root/oko/backend/static/
#20 CACHED

#21 [test  5/11] COPY --from=backend /opt/opencv /opt/opencv
#21 CACHED

#22 [test  3/11] RUN set -xeu &&     DEBIAN_FRONTEND=noninteractive apt-get install -y curl clang libclang-dev     cmake     libavcodec-dev libavformat-dev libavutil-dev libswscale-dev
#22 CACHED

#23 [frontend 2/3] RUN set -xeu && 	git clone https://github.com/piotrpdev/oko.git /root/oko
#23 CACHED

#24 [test 11/11] RUN set -xeu && 	cd /root/oko/backend && 	cargo test
#24 CACHED

#25 exporting to image
#25 exporting layers done
#25 writing image sha256:3f352cdad530cb92ea7b892125839a6724da0858cd85b7fe01f48548874aec48 done
#25 DONE 0.0s
